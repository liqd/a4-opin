{% load i18n form_tags widget_tweaks %}

<script src="http://code.highcharts.com/js/highcharts.js"></script>
<script src="http://code.highcharts.com/js/highcharts-more.js"></script>
<script src="http://code.highcharts.com/stock/js/highstock.js"></script>
<script src="http://code.highcharts.com/maps/js/modules/map.js"></script>

<script type="text/javascript">
var pollresult = {{pollresult|get_simplejson|safe}};
var poll = {{poll|get_simplejson|safe}};
console.log("noOfReceivedResults: "+ pollresult.noOfReceivedResults);

$(function () {

    console.log("noOfReceivedResults 1");

		for(ind=0;ind<poll.questions.length;ind++){
			question = poll.questions[ind];
			var answer_text_list = [];
			var answer_percent_list = [];

			for(indc=0;indc<question.answers.length;indc++){
			    answer = question.answers[indc];
			    answer_text_list.push(answer.answerText);
			    var score = pollresult.pollResQuestions[ind].pollResultAnswers[indc].answerScore;
			    var percent = (score/pollresult.noOfReceivedResults)*100;
			    answer_percent_list.push(percent);
			}

            var myChart = Highcharts.chart('container-'+question.orderId, {
                chart: {
                    type: 'bar'
                },
                title: {
                    text: question.questionText
                },
                xAxis: {
                    categories: answer_text_list
                },
                yAxis: {
                    title: {
                        text: 'Percent'
                    },
                    max: 100
                },
                series: [{
                    name: 'Total: '+pollresult.noOfReceivedResults,
                    data: answer_percent_list
                }]
            });
    }
});

var chart1; // globally available
$(function() {
       console.log("noOfReceivedResults 2");

		for(ind=0;ind<poll.questions.length;ind++){
			question = poll.questions[ind];
           chart1 = Highcharts.stockChart('container-'+question.orderId, {
             rangeSelector: {
                selected: 1
             },
             series: [{
                name: 'USD to EUR',
                data: usdtoeur // predefined JavaScript array
             }]
          });
      }
   });
</script>

<article id="result" class="tab-panel">

    <div class="form-section">
        <h3 class="form-section-heading">{% trans 'Result '%}</h3>
        <div class="form-section-fields">
            {% for question in poll.questions %}
                {% if question.questionType == 'CHECKBOX' or question.questionType == 'RADIO' %}
                <div class="form-group">
                    <div id="container-{{question.orderId}}" style="width:100%; height:400px;"></div>
                </div>
                {% else  %}
                <div class="form-group">
                    <label >{{ question.questionText }}</label>
                    <p class='form-help-text'>Visualization not implemented for this question type of question</p>
                </div>
                {% endif %}
            {% endfor %}

            <div class="form-group{% if field.errors %} has-error{% endif %}">
                <label for="{{form.project.result.id_for_label}}">{{ form.project.result.label }}</label>
                <p class='form-help-text'>{{ form.project.result.help_text }}</p>
                {% render_field form.project.result class="form-control" %}
                <span class="help-block">{{ error }}</span>
            </div>
        </div>
    </div>

</article>
