{% load static i18n form_tags flashpoll_form_tags widget_tweaks %}

<link rel="stylesheet" href="{% static 'highcharts.css' %}">
<script src="{% static 'highcharts.js' %}"></script>
<script type="text/javascript">

var pollresult = {{pollresult|get_simplejson|safe}};
var poll = {{poll|get_simplejson|safe}};

$(function () {
        if(pollresult.noOfReceivedResults && pollresult.noOfReceivedResults != 0){
            for(ind=0;ind<poll.questions.length;ind++){
                question = poll.questions[ind];
                var answer_text_list = [];
                var answer_percent_list = [];

                for(indc=0;indc<question.answers.length;indc++){
                    answer = question.answers[indc];
                    answer_text_list.push(answer.answerText);
                    var score = pollresult.pollResQuestions[ind].pollResultAnswers[indc].answerScore;
                    var percent = (score/pollresult.noOfReceivedResults)*100;
                    answer_percent_list.push(percent);
                }

                var myChart = Highcharts.chart('container-'+question.orderId, {
                    chart: {
                        type: 'bar'
                    },
                    title: {
                        text: question.questionText
                    },
                    xAxis: {
                        categories: answer_text_list
                    },
                    yAxis: {
                        title: {
                            text: 'Percent'
                        },
                        max: 100
                    },
                    series: [{
                        name: 'Total: '+pollresult.noOfReceivedResults,
                        data: answer_percent_list
                    }]
                });
        }
    }
});

</script>

<article id="result" class="tab-panel">

    <div class="form-section">
        <h3 class="form-section-heading">{% trans 'Result '%}</h3>
        <div class="form-section-fields">

            <div class="form-group{% if field.errors %} has-error{% endif %}">
                <label for="{{form.project.result.id_for_label}}">{{ form.project.result.label }}</label>
                <p class='form-help-text'>{{ form.project.result.help_text }}</p>
                {% render_field form.project.result class="form-control" %}
                <span class="help-block">{{ error }}</span>
            </div>
			{% if pollresult.noOfReceivedResults != 0 %}
				{% for question in poll.questions %}
					{% if question.questionType == 'CHECKBOX' or question.questionType == 'RADIO' %}
					<div class="form-group">
						<div id="container-{{question.orderId}}" style="width:100%; height:400px;"></div>
					</div>
					{% else  %}
					<div class="form-group">
						<label >{{ question.questionText }}</label>
						<p class='form-help-text'>Visualization not implemented of this question type of question</p>
					</div>
					{% endif %}
				{% endfor %}
			{% endif %}
        </div>
    </div>

</article>
